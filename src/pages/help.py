"""
帮助页面 - 提供详细的使用说明和功能介绍
"""

import streamlit as st
from datetime import datetime

def show_help_page():
    """显示帮助页面"""
    st.title("📚 使用帮助")
    
    # 侧边栏导航
    st.sidebar.title("帮助导航")
    help_section = st.sidebar.selectbox(
        "选择帮助主题",
        [
            "🏠 快速开始",
            "📊 价格监控",
            "🔄 套利分析",
            "📈 市场分析",
            "⚙️ 设置配置",
            "🔧 故障排除",
            "❓ 常见问题"
        ]
    )
    
    if help_section == "🏠 快速开始":
        show_quick_start()
    elif help_section == "📊 价格监控":
        show_price_monitoring_help()
    elif help_section == "🔄 套利分析":
        show_arbitrage_help()
    elif help_section == "📈 市场分析":
        show_market_analysis_help()
    elif help_section == "⚙️ 设置配置":
        show_settings_help()
    elif help_section == "🔧 故障排除":
        show_troubleshooting()
    elif help_section == "❓ 常见问题":
        show_faq()

def show_quick_start():
    """快速开始指南"""
    st.header("🏠 快速开始")
    
    st.markdown("""
    ### 欢迎使用加密货币比较工具！
    
    这是一个功能强大的加密货币价格监控和套利分析平台，帮助您：
    - 📊 实时监控多个交易所的价格
    - 🔄 发现套利机会
    - 📈 分析市场趋势
    - ⚡ 获取最新的市场数据
    
    ### 🚀 开始使用
    
    1. **选择功能页面**
       - 使用左侧导航栏选择您需要的功能
       - 每个页面都有特定的用途和功能
    
    2. **选择交易对**
       - 在下拉菜单中选择您感兴趣的加密货币交易对
       - 支持主流交易对如 BTC/USDT, ETH/USDT 等
    
    3. **查看实时数据**
       - 数据每分钟自动更新
       - 可以手动刷新获取最新信息
    
    4. **分析结果**
       - 查看价格差异和套利机会
       - 使用图表分析价格趋势
    """)
    
    st.info("💡 提示：首次使用时，系统可能需要几秒钟来获取数据，请耐心等待。")

def show_price_monitoring_help():
    """价格监控帮助"""
    st.header("📊 价格监控")
    
    st.markdown("""
    ### 功能概述
    价格监控页面让您实时查看多个交易所的加密货币价格。
    
    ### 主要功能
    
    #### 🔍 实时价格显示
    - **当前价格**：显示各交易所的最新价格
    - **买入价/卖出价**：显示最佳买入和卖出价格
    - **24小时变化**：显示价格涨跌幅
    - **交易量**：显示24小时交易量
    
    #### 📈 价格图表
    - 实时价格走势图
    - 支持不同时间周期
    - 可以比较多个交易所价格
    
    #### ⚡ 自动刷新
    - 数据每60秒自动更新
    - 可以手动点击刷新按钮立即更新
    
    ### 使用技巧
    
    1. **选择交易对**
       ```
       在页面顶部的下拉菜单中选择您要监控的交易对
       ```
    
    2. **查看价格差异**
       ```
       不同交易所的价格可能存在差异，这些差异可能带来套利机会
       ```
    
    3. **关注异常数据**
       ```
       如果某个交易所的价格明显偏离其他交易所，可能存在问题或机会
       ```
    """)
    
    st.warning("⚠️ 注意：价格数据仅供参考，实际交易前请确认交易所的真实价格。")

def show_arbitrage_help():
    """套利分析帮助"""
    st.header("🔄 套利分析")
    
    st.markdown("""
    ### 什么是套利？
    套利是指利用不同交易所之间的价格差异来获取无风险利润的交易策略。
    
    ### 套利类型
    
    #### 🔄 现货套利
    - 在价格较低的交易所买入
    - 在价格较高的交易所卖出
    - 赚取价格差异
    
    #### ⚡ 快速套利
    - 利用短期价格波动
    - 需要快速执行交易
    - 风险相对较低
    
    ### 套利指标说明
    
    #### 📊 价格差异
    ```
    价格差异 = (最高价 - 最低价) / 最低价 × 100%
    ```
    
    #### 💰 潜在利润
    ```
    潜在利润 = 价格差异 - 交易费用 - 转账费用
    ```
    
    #### ⭐ 套利评分
    - **A级**：价格差异 > 2%，高利润机会
    - **B级**：价格差异 1-2%，中等机会
    - **C级**：价格差异 0.5-1%，小额机会
    - **D级**：价格差异 < 0.5%，机会较小
    
    ### 风险提示
    
    ⚠️ **重要风险**：
    1. **转账时间**：资金转移需要时间，价格可能变化
    2. **交易费用**：买卖手续费会减少利润
    3. **网络拥堵**：区块链网络可能延迟
    4. **流动性风险**：大额交易可能影响价格
    5. **交易所风险**：交易所可能暂停充提
    
    ### 使用建议
    
    1. **小额测试**：首次尝试时使用小额资金
    2. **快速执行**：发现机会后尽快执行
    3. **计算成本**：确保利润覆盖所有费用
    4. **分散风险**：不要将所有资金投入单一机会
    """)

def show_market_analysis_help():
    """市场分析帮助"""
    st.header("📈 市场分析")
    
    st.markdown("""
    ### 市场概览功能
    
    #### 📊 整体市场状况
    - **活跃交易对数量**：显示当前监控的交易对数量
    - **平均价格差异**：所有交易对的平均价格差异
    - **套利机会数量**：当前可用的套利机会数量
    
    #### 🔥 热门交易对
    - 按交易量排序的热门交易对
    - 显示价格变化和套利潜力
    
    #### 📈 趋势分析
    - 价格趋势图表
    - 成交量分析
    - 市场情绪指标
    
    ### 技术指标说明
    
    #### 📊 价格指标
    - **MA (移动平均线)**：显示价格趋势
    - **波动率**：价格变化的剧烈程度
    - **支撑位/阻力位**：关键价格水平
    
    #### 📈 成交量指标
    - **24小时成交量**：交易活跃度
    - **成交量变化**：与历史数据对比
    
    ### 使用技巧
    
    1. **关注趋势**
       ```
       观察价格和成交量的变化趋势，判断市场方向
       ```
    
    2. **比较分析**
       ```
       对比不同交易对的表现，发现投资机会
       ```
    
    3. **时机选择**
       ```
       结合技术指标选择最佳的交易时机
       ```
    """)

def show_settings_help():
    """设置配置帮助"""
    st.header("⚙️ 设置配置")
    
    st.markdown("""
    ### 系统设置
    
    #### 🔄 数据更新设置
    - **自动刷新间隔**：设置数据自动更新的时间间隔
    - **缓存时间**：设置数据缓存的有效时间
    - **超时设置**：API请求的超时时间
    
    #### 🎯 交易所选择
    - **启用/禁用交易所**：选择要监控的交易所
    - **优先级设置**：设置交易所的优先级
    - **API配置**：配置交易所API参数
    
    #### 📊 显示设置
    - **默认交易对**：设置默认显示的交易对
    - **价格精度**：设置价格显示的小数位数
    - **图表样式**：选择图表的显示样式
    
    ### 高级设置
    
    #### 🔧 性能优化
    ```python
    # 缓存设置
    CACHE_TTL = 60  # 缓存时间（秒）
    MAX_RETRIES = 3  # 最大重试次数
    TIMEOUT = 10    # 请求超时时间（秒）
    ```
    
    #### 🛡️ 安全设置
    - **API密钥管理**：安全存储API密钥
    - **访问控制**：设置访问权限
    - **日志记录**：配置日志级别
    
    ### 配置文件
    
    系统配置保存在以下位置：
    ```
    config/
    ├── exchanges.json      # 交易所配置
    ├── settings.json       # 系统设置
    └── user_preferences.json  # 用户偏好
    ```
    """)

def show_troubleshooting():
    """故障排除"""
    st.header("🔧 故障排除")
    
    st.markdown("""
    ### 常见问题解决方案
    
    #### 🚫 数据加载失败
    
    **问题**：页面显示"无法获取数据"或加载时间过长
    
    **解决方案**：
    1. 检查网络连接
    2. 刷新页面重试
    3. 清除浏览器缓存
    4. 检查交易所API状态
    
    #### ⚠️ 价格数据异常
    
    **问题**：显示的价格明显不正确
    
    **解决方案**：
    1. 对比多个数据源
    2. 检查交易所官网价格
    3. 等待数据自动更新
    4. 手动刷新数据
    
    #### 🐌 系统运行缓慢
    
    **问题**：页面响应慢或卡顿
    
    **解决方案**：
    1. 关闭其他浏览器标签页
    2. 减少监控的交易对数量
    3. 增加数据更新间隔
    4. 重启应用程序
    
    ### 错误代码说明
    
    #### HTTP错误代码
    - **403**：访问被拒绝（可能是地区限制）
    - **429**：请求频率过高（触发限流）
    - **500**：服务器内部错误
    - **503**：服务暂时不可用
    
    #### 应用错误代码
    - **E001**：API密钥无效
    - **E002**：网络连接超时
    - **E003**：数据解析错误
    - **E004**：缓存读写失败
    
    ### 日志查看
    
    #### 查看系统日志
    ```bash
    # 查看应用日志
    tail -f logs/app.log
    
    # 查看错误日志
    tail -f logs/error.log
    ```
    
    #### 日志级别说明
    - **DEBUG**：详细调试信息
    - **INFO**：一般信息
    - **WARNING**：警告信息
    - **ERROR**：错误信息
    - **CRITICAL**：严重错误
    
    ### 联系支持
    
    如果问题仍然存在，请：
    1. 记录错误信息和操作步骤
    2. 截图保存错误页面
    3. 检查系统日志
    4. 联系技术支持
    """)

def show_faq():
    """常见问题"""
    st.header("❓ 常见问题")
    
    st.markdown("""
    ### 💰 关于套利交易
    
    **Q: 套利交易真的能赚钱吗？**
    A: 套利交易在理论上可以获得无风险利润，但实际操作中需要考虑交易费用、转账时间、滑点等因素。建议先小额测试。
    
    **Q: 为什么不同交易所价格会有差异？**
    A: 价格差异主要由以下因素造成：
    - 流动性差异
    - 地理位置限制
    - 交易量不同
    - 市场情绪差异
    - 技术问题
    
    **Q: 套利的最佳时机是什么时候？**
    A: 通常在以下情况下套利机会较多：
    - 市场波动剧烈时
    - 重大新闻发布后
    - 交易所维护期间
    - 网络拥堵时期
    
    ### 📊 关于数据准确性
    
    **Q: 数据多久更新一次？**
    A: 系统默认每60秒自动更新一次数据，您也可以手动刷新获取最新数据。
    
    **Q: 为什么有时候显示模拟数据？**
    A: 当无法从交易所获取真实数据时（如API限制、网络问题），系统会显示模拟数据以保证功能正常运行。
    
    **Q: 如何确保数据的准确性？**
    A: 建议：
    - 对比多个数据源
    - 查看交易所官网确认
    - 关注数据时间戳
    - 注意异常价格提示
    
    ### 🔧 技术问题
    
    **Q: 为什么某些交易所显示"无数据"？**
    A: 可能的原因：
    - 交易所API维护
    - 网络连接问题
    - 地区访问限制
    - 交易对不支持
    
    **Q: 如何提高数据获取速度？**
    A: 可以尝试：
    - 减少监控的交易所数量
    - 增加缓存时间
    - 使用更快的网络连接
    - 选择延迟较低的服务器
    
    **Q: 系统支持哪些交易对？**
    A: 目前支持主流交易对：
    - BTC/USDT
    - ETH/USDT
    - BNB/USDT
    - ADA/USDT
    - SOL/USDT
    - 更多交易对持续添加中...
    
    ### 🛡️ 安全相关
    
    **Q: 系统是否安全？**
    A: 本系统仅用于数据查看和分析，不涉及资金操作，相对安全。但请注意：
    - 不要在公共网络使用
    - 定期更新系统
    - 保护个人信息
    
    **Q: 是否需要提供API密钥？**
    A: 当前版本使用公开API，无需提供密钥。如需要更高级功能，可能需要配置API密钥。
    
    ### 📞 获取帮助
    
    **Q: 如何获得更多帮助？**
    A: 您可以：
    - 查看本帮助文档
    - 查看系统日志
    - 联系技术支持
    - 参考在线文档
    
    **Q: 如何报告问题或建议？**
    A: 欢迎通过以下方式反馈：
    - 记录详细的问题描述
    - 提供错误截图
    - 说明操作步骤
    - 提交问题报告
    """)
    
    st.info("💡 如果您的问题没有在这里找到答案，请查看其他帮助章节或联系技术支持。")

if __name__ == "__main__":
    show_help_page()